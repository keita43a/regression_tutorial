# 記述統計 {#rstats}


## 統計とは

統計学はおおまかに**記述統計**と**推測統計**の２つから成り立っている。記述統計は得られたデータからその特徴を抜き出す統計であり、推測統計は全体の把握が難しいような大きな対象やまだ起こっていないことなどに対して推測を行う統計である。

### 記述統計

記述統計の代表的なものに人口統計がある。その国や地域に現在人口が何人いるか？男女比は？年齢構成は？などの特徴を把握するための手続きである。

記述統計を行うためには、**ヒストグラム**などのビジュアライゼーションと、平均値・標準偏差などの**統計量**による記述の方法がある。

### 推測統計 {#infstats}

たとえば、日本人全員の身長を知ろうとして、全員を調査するのは難しい。しかし、全員を調査をできなくても、一部の人を調査することで全体を推測することができる。

身近なものには選挙の当確がある。例えば、AさんとBさんのいずれかを選ぶ投票を行い、1万人が投票したとする。過半数を取らないと当選にならないので、少なくともいずれかが5000票獲得するまでは勝負は決まらない。しかし、開票率１％で当確が出ることがある。1万票の１％は100票である。それだけしか開票していないのになぜ「当選確実」といえるのだろうか。

　票が入った箱をよく混ぜてそこから100票を取り出すとしよう。そして、90票がAさんで、のこり10票がBさんだったどうだろうか。おそらくAさんが勝つだろうということになる。かなり高い確率で、残りの9900票の多数もAさんに投票されていると考えるのが妥当だからだ。もちろん確率の問題であるため、当確が取り消されることもまれにある。しかし、ある程度の間違いがあるとしたうえで、まだわからないもの、もしくは規模が大きすぎてわからないものを少ないサンプルで推測しようとするのが推測統計である。
　
　このような推測統計を行う際には「よく混ぜる」ことが重要である。イメージとしてはコーヒーにミルクを混ぜる場合である。しっかりとかき混ぜれば、スプーンで掬った一部とカップの中は同じ濃さのはずであるが、きちんと混ざっていなければ、まだ良く混ざっていないコーヒーの部分を掬ってもカップの中の味を再現することはできない。


## 準備

あらたにRスクリプトを作成し、`stats.R`という名前をつけて保存する。

そして、以下のライブラリを読み込んでおく。ライブラリがなくてエラーが出る場合はインストールしてから再度読み込む。

```{r}
library(tidyverse)
library(psych)
library(skimr)
```


## データとは

統計において分析する対象はデータである。データには様々な形があるが、一般的には数値や文字情報の集まりである。

以下のコードを実行してみよう。すると、100個の数値が並ぶ。これをランダムにサンプリングして計測した日本人男性の身長だとしよう。

```{r}
set.seed(3)
height <- rnorm(100,mean=170,sd=10) |> round()

height
```

この数字を見てどう思うか？

「ああ、数字が並んでいるなぁ」

「自分はこの中では高いほうかな」


などと思うかもしれない。
まず、身長はみんな同じではない。言い換えると、様々な数値を取る。これを**分布する**と呼ぶ。

なぜ数値は分布するのだろうか。それは、データを生み出す背景に不確実性があるから。日本人男性の身長が決まるメカニズムが存在する。また個々人で条件が異なる。そういった背景が身長という数値となって現れている。


一方で、数字の決まり方には特徴や癖がある。たとえば身長1cmや身長100mの人はいない。「普通」の身長に近いひとは多く、特に低い人や高い人は数としては少ない。こういった分布の特性がある。どうやって特徴や癖を把握すればいいのか？

数字がざっと並んでいるだけでは、イマイチよくわからない。そこで、**生データ（生の現実）から、特徴や癖を引き出す手法**が統計なのである。

ではどのように特徴や癖を引き出すか。これにはデータの縮約を行う。
縮約とはデータとして並んでいるたくさんの数字を、なにかの基準で整理整頓して、意味のある情報だけを抽出することである。

縮約には大きく分けて二つの方法がある。一つ目は、1つの数字で特徴を代表させる方法である。この代表される数字を**統計量**である。二つ目は、グラフ化してその特徴をとらえようとすることである。近年ではVisualizationとも呼ばれる。

この章では代表的な統計量をおさらいし、そのRでの計算方法を学ぶ。

## 代表的な統計量

### 数式

まず、数式の読み方について簡単におさらいする。数式は英語と同じで意味がわかれば怖いものではないので、一つずつ確認しよう。

統計学では、データを表現するのによく文字を使う。例えば$x$である。しかし、データが100個ある場合には、$x_{1},x_{2},\ldots,x_{100}$といったように、右下に添え字をつけてデータを区別する。このとき、一般的な言い方をするために$i$番目のデータを$x_{i}$と表記することがある。

ここで、厳密には統計量ではないが、データの合計の計算方法を勉強しよう。
例えば上の身長の例のように、100個のデータを合計するためには、100個の数値を足す必要がある。それを数式で表現すると、

$$
  x_1 + x_2 + x_3 +\cdots + x_{100}
$$
のように、100個の数字を書く必要があるが、現実には書けない。

そこで、数列の和の記号であるシグマを使う。

$$
\sum^{100}_{i=1}x_i = x_1 + x_2 + x_3 +\cdots + x_{100}
$$

上の左辺のシグマ記号で書かれたものは、右辺と同じ意味である。
つまり上のシグマ記号$\sum$は、「$i=1$から、$100$までの$x_i$を足し合わせる」という意味を持つ。

合計をRで計算するときには、`sum()`という関数を使って以下のようになる。ここではheightというオブジェクトに100個の数値を持つベクトルが入っているため、`sum()`はベクトルのすべての数値を足し合わせる。

```{r}
sum(height)
```


### 平均

もっとも身近な統計量は平均であろう。統計学において平均値とは一般的に算術平均（相加平均）を指す。これはすべてのデータを合計し、それをデータの個数で割ることで求められる。

統計ではよくデータ$x_{i}$の平均を、$x$に棒をつけて$\bar{x}$と表現する。

$$
\bar{x} = \frac{1}{n}\sum^{n}_{i=1}x_i
$$

これをRで計算するときには、`mean()`という関数が用意されている。

```{r}
mean(height)
```

### 中央値

中央値は、一言でいうと「真ん中」にある数値である。数値を小さい順に並べ、その真ん中にある数値を代表値として選ぶ。これは平均値と一致することもあれば、異なることもある。

もう少し厳密に定義すると、
$n$個の観測値からなるデータ($x_1,x_2,\ldots,x_n$)を小さい順に並べたものを($x_1',x_2',\ldots,x_{n}'$) とする。中央値$Q_{\frac{1}{2}}$は

$$
Q_{\frac{1}{2}} = \begin{cases}
x_{\frac{n}{2}} & \text{もし } n \text{が奇数の場合} \\
\frac{1}{2}(x_{\frac{n}{2}} + x_{\frac{n}{2}+1}) & \text{もし } n \text{が偶数の場合}
\end{cases}
$$

難しく見えるかもしれないが、単純なことを行っている。$n$,つまりデータの個数が奇数ならば、「真ん中」の数値が中央値となる。データの個数が5なら3番目, 99なら50番目である。
もし、データが偶数ならば、「真ん中」の数値はない。そこで、ちょうど真ん中を挟む二つの数字の平均を取る。100個のデータがあるならば、50番目と51番目の数字の平均を取ることで中央値とする。

Rでの計算は`median()`関数を用いる。medianは文字通り英語で中央値という意味である。

```{r}
median(height)
```

### 最大値・最小値

データの中で最も大きい数値、小さい数値もデータの特徴を表す。

Rでは`max()`関数, `min()`関数で算出できる。

```{r}
# データの最大値
max(height)

# データの最小値
min(height)

```


### 分散

分散は、データのばらつきを示す統計量である。数値が大きければデータは互いに大きく異なる数値を取っており、小さけば近い数値を取っている。分散は、それぞれのデータの数値から平均値を引き、それを二乗することで求められる。

$$
 \sigma^2 = \frac{1}{n}\sum^{n}_{i=1}( x_i - \bar{x})^2
$$

Rで分散を計算する関数はデフォルトでは**用意されていない**。なぜないのかは、Section \@ref(rstatsinfe)の不偏分散の項で説明する。

分散をRで計算すると、自分で数式を表現する必要があるが以下のようになる。

```{r}

height_mean <- mean(height) # heightの平均値
height_n <- length(height)  # heightのデータの個数


sigma2 = sum((height-height_mean)^2)/height_n
sigma2
```

### もう一つの分散：不偏分散

不偏分散は同じくデータの散らばりを示す統計量である。標本分散と呼んだり、文脈によっては単に分散と呼んでこちらを指す場合もある。
詳しくは推定統計量の項で説明する。

分散との違いは、`n`で割るか、`n-1`で割るかの違いである。

$$
 s^2 = \frac{1}{n-1}\sum^{n}_{i=1}( x_i - \bar{x})^2
$$


Rでは`var()`関数で計算できる。

```{r}

s2 = var(height)
s2

```


### 標準偏差

標準偏差もデータのばらつきを表す。
分散もばらつきを表す統計量なので、なぜ二つあるのか？と思うかもしれない。
分散は、データのばらつきを二乗してから合計してデータ数で割っている。そのため、数値大きさはばらつきを示すが、その数値の単位は二乗されてしまっている。身長のケースで言えば$cm^2$となっているのである。

これでは平均に対してばらつきが大きいのか小さいのかわかりにくい。
そこで、標準偏差は分散の平方根（ルート）を取ることで、計算される。
二乗のルートなので、単位がもとに戻って解釈しやすくなるのである。

$$
 \sigma = \sqrt{\sigma^2}
$$

ここでは単純に上で計算した分散のルーとしてを計算しよう。ルートは`sqrt()`という関数で計算できる。

```{r}
sigma = sqrt(sigma2)
sigma
```

### 不偏標準偏差

標準偏差を計算するために、不偏分散を用いたものが不偏標準偏差である。標本標準偏差と呼ばれたり、文脈によっては単に標準偏差とよんでこちらを指す場合もある。
以下の記述統計などではこちらが一般的に使われる。
理由は推定統計量の項を参照してほしい。

$$
 s = \sqrt{s^2}
$$
不偏標準偏差は上と同様にルートでも計算できるが、`sd()`という関数が用意されている。確認するために、いずれの方法でも計算してみよう。
```{r}
s = sqrt(s2)
s
```

`sd`関数を使う場合

```{r}
s = sd(height)
s
```




## Rによる記述統計のテクニック

ここでは、簡単に記述統計を示すテクニックを紹介する。
データ分析を行う上で、手元のデータがどういうデータなのかを記述統計で見るのは重要である。
また、論文にする際にも、まずはデータの説明として記述統計表を示すのが一般的である。

### 使用するデータ

ここではRにもともと入っているmtcarsというデータを使用する。
1974年にアメリカのMotor Trendという雑誌に掲載された燃費などの性能を比較したデータである。

例えば`mpg`は燃費（１ガロン当たりのマイル）、`cyl`はシリンダーの数、`hp`はエンジンの馬力、`wt`は重さ、などである。
詳しく知りたい人は、RStudioの右下ペーンの[Help]タブから、`mtcars`と検索してみよう。

```{r}
data(mtcars) #データの呼び出し

mtcars
```


### `summary`関数

summaryというRデフォルトの関数(`base`関数と呼ぶ)を使うと、最小・最大・平均・中央値・四分位点などが表示される。

```{r}
summary(mtcars)
```

### `describe`関数

`describe`関数を使うと、簡単にデータ数(`n`)、平均、標準偏差や範囲を計算することができる。ここで計算されている標準偏差は不偏標準偏差である。

```{r}
library(psych)
describe(mtcars, skew=FALSE)
```


### `skim`関数

`skim`関数を使うと、記述統計に加えて簡単なヒストグラムも図示してくれる。ここで計算されている標準偏差は不偏標準偏差である。

```{r}
library(skimr)
skim(mtcars)
```
